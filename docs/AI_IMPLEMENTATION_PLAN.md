# backup-suite AIé€£æºæ©Ÿèƒ½ - è©³ç´°å®Ÿè£…è¨ˆç”»æ›¸

**ä½œæˆæ—¥**: 2025-11-09
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0.0
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: è¨­è¨ˆãƒ•ã‚§ãƒ¼ã‚º

---

## ğŸ“‹ ç›®æ¬¡

1. [ã‚¨ã‚°ã‚¼ã‚¯ãƒ†ã‚£ãƒ–ã‚µãƒãƒªãƒ¼](#1-ã‚¨ã‚°ã‚¼ã‚¯ãƒ†ã‚£ãƒ–ã‚µãƒãƒªãƒ¼)
2. [ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆ](#2-ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆ)
3. [Phase 1: è»½é‡MLæ©Ÿèƒ½](#3-phase-1-è»½é‡mlæ©Ÿèƒ½)
4. [Phase 2: Ollamaçµ±åˆ](#4-phase-2-ollamaçµ±åˆ)
5. [ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®äº‹é …](#5-ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®äº‹é …)
6. [ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›®æ¨™](#6-ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›®æ¨™)
7. [å®Ÿè£…ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—](#7-å®Ÿè£…ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—)
8. [ãƒ†ã‚¹ãƒˆæˆ¦ç•¥](#8-ãƒ†ã‚¹ãƒˆæˆ¦ç•¥)
9. [ä¾å­˜é–¢ä¿‚](#9-ä¾å­˜é–¢ä¿‚)
10. [ãƒªã‚¹ã‚¯ã¨å¯¾ç­–](#10-ãƒªã‚¹ã‚¯ã¨å¯¾ç­–)

---

## 1. ã‚¨ã‚°ã‚¼ã‚¯ãƒ†ã‚£ãƒ–ã‚µãƒãƒªãƒ¼

### 1.1 ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

backup-suite ã« AI/ML é€£æºæ©Ÿèƒ½ã‚’è¿½åŠ ã—ã€ä»¥ä¸‹ã®ä¾¡å€¤ã‚’æä¾›ã—ã¾ã™ï¼š

- **ã‚¤ãƒ³ãƒ†ãƒªã‚¸ã‚§ãƒ³ãƒˆãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—æ¨å¥¨**: ãƒ•ã‚¡ã‚¤ãƒ«é‡è¦åº¦ã®è‡ªå‹•åˆ¤å®šã€ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å¯¾è±¡ã®è‡ªå‹•ææ¡ˆ
- **ç•°å¸¸æ¤œçŸ¥ãƒ»äºˆæ¸¬ã‚¢ãƒ©ãƒ¼ãƒˆ**: ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚µã‚¤ã‚ºç•°å¸¸æ¤œçŸ¥ã€ãƒ‡ã‚£ã‚¹ã‚¯å®¹é‡æ¯æ¸‡äºˆæ¸¬
- **è‡ªç„¶è¨€èªãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—è¨­å®š**: å¯¾è©±çš„ãªè¨­å®šã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
- **AIé§†å‹•ãƒ¬ãƒãƒ¼ãƒˆãƒ»åˆ†æ**: çµ±è¨ˆã®è‡ªç„¶è¨€èªã‚µãƒãƒªãƒ¼ã€æ”¹å–„ææ¡ˆç”Ÿæˆ

### 1.2 å®Ÿè£…ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ

**ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ã‚¢ãƒ—ãƒ­ãƒ¼ãƒï¼ˆèª²é‡‘ãªã—ï¼‰**:

- **Phase 1ï¼ˆè»½é‡MLï¼‰**: Rust nativeå®Ÿè£…ã«ã‚ˆã‚‹çµ±è¨ˆçš„ç•°å¸¸æ¤œçŸ¥ã¨æ¨å¥¨ã‚¨ãƒ³ã‚¸ãƒ³ï¼ˆå¸¸æ™‚åˆ©ç”¨å¯èƒ½ï¼‰
- **Phase 2ï¼ˆOllamaçµ±åˆï¼‰**: ã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ãªè‡ªç„¶è¨€èªå‡¦ç†æ©Ÿèƒ½ï¼ˆGraceful degradationï¼‰

### 1.3 ä¸»è¦æˆæœç‰©

| æˆæœç‰© | èª¬æ˜ | æ‹…å½“Agent |
|--------|------|-----------|
| å‹å®šç¾©ãƒ»ã‚¨ãƒ©ãƒ¼å‡¦ç† | newtype patternã€thiserrorçµ±åˆ | rust-engineer |
| ç•°å¸¸æ¤œçŸ¥ã‚¨ãƒ³ã‚¸ãƒ³ | Z-scoreã€ç·šå½¢å›å¸°ã«ã‚ˆã‚‹çµ±è¨ˆåˆ†æ | rust-engineer |
| æ¨å¥¨ã‚¨ãƒ³ã‚¸ãƒ³ | ãƒ•ã‚¡ã‚¤ãƒ«é‡è¦åº¦åˆ¤å®šã€é™¤å¤–ææ¡ˆ | rust-engineer |
| CLI UX | clap 4.xã€å›½éš›åŒ–ã€Graceful degradation | cli-developer |
| Ollamaçµ±åˆ | HTTP clientã€è‡ªç„¶è¨€èªãƒ‘ãƒ¼ã‚µãƒ¼ | rust-engineer |
| ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£æŸ» | ãƒ‡ãƒ¼ã‚¿ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ã€æ©Ÿå¯†æƒ…å ±ä¿è­· | security-auditor |
| ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ– | ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã€ä¸¦åˆ—å‡¦ç†æˆ¦ç•¥ | performance-engineer |

---

## 2. ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆ

### 2.1 ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«æ§‹é€ 

```
src/
â”œâ”€â”€ ai/                              # æ–°è¦AIãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
â”‚   â”œâ”€â”€ mod.rs                       # AIãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
â”‚   â”œâ”€â”€ anomaly/                     # Phase 1: ç•°å¸¸æ¤œçŸ¥ã‚¨ãƒ³ã‚¸ãƒ³
â”‚   â”‚   â”œâ”€â”€ mod.rs
â”‚   â”‚   â”œâ”€â”€ detector.rs              # çµ±è¨ˆçš„ç•°å¸¸æ¤œçŸ¥ï¼ˆZ-scoreï¼‰
â”‚   â”‚   â”œâ”€â”€ predictor.rs             # ãƒ‡ã‚£ã‚¹ã‚¯å®¹é‡äºˆæ¸¬ï¼ˆç·šå½¢å›å¸°ï¼‰
â”‚   â”‚   â””â”€â”€ pattern.rs               # å¤±æ•—ãƒ‘ã‚¿ãƒ¼ãƒ³åˆ†æ
â”‚   â”œâ”€â”€ recommendation/              # Phase 1: ã‚¤ãƒ³ãƒ†ãƒªã‚¸ã‚§ãƒ³ãƒˆæ¨å¥¨
â”‚   â”‚   â”œâ”€â”€ mod.rs
â”‚   â”‚   â”œâ”€â”€ importance.rs            # ãƒ•ã‚¡ã‚¤ãƒ«é‡è¦åº¦åˆ¤å®š
â”‚   â”‚   â”œâ”€â”€ suggest.rs               # ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å¯¾è±¡ã®è‡ªå‹•ææ¡ˆ
â”‚   â”‚   â””â”€â”€ exclude.rs               # é™¤å¤–ãƒ•ã‚¡ã‚¤ãƒ«ã®è‡ªå‹•æ¤œå‡º
â”‚   â”œâ”€â”€ llm/                         # Phase 2: Ollamaçµ±åˆï¼ˆfeature gatedï¼‰
â”‚   â”‚   â”œâ”€â”€ mod.rs
â”‚   â”‚   â”œâ”€â”€ client.rs                # Ollama HTTPã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
â”‚   â”‚   â”œâ”€â”€ parser.rs                # è‡ªç„¶è¨€èªãƒ‘ãƒ¼ã‚µãƒ¼
â”‚   â”‚   â””â”€â”€ report.rs                # AIé§†å‹•ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
â”‚   â”œâ”€â”€ types.rs                     # AIå…±é€šå‹å®šç¾©ï¼ˆnewtype patternï¼‰
â”‚   â””â”€â”€ error.rs                     # AIå›ºæœ‰ã®ã‚¨ãƒ©ãƒ¼å‹
```

### 2.2 å‹è¨­è¨ˆï¼ˆNewtype Patternæ´»ç”¨ï¼‰

```rust
// src/ai/types.rs

/// ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚µã‚¤ã‚ºï¼ˆãƒã‚¤ãƒˆå˜ä½ï¼‰
#[derive(Debug, Clone, Copy, PartialEq, Eq, Serialize, Deserialize)]
pub struct BackupSize(u64);

/// äºˆæ¸¬ä¿¡é ¼åº¦ï¼ˆ0.0 - 1.0ï¼‰
#[derive(Debug, Clone, Copy, PartialEq, Serialize, Deserialize)]
pub struct PredictionConfidence(f64);

/// ãƒ•ã‚¡ã‚¤ãƒ«é‡è¦åº¦ï¼ˆ0 - 100ï¼‰
#[derive(Debug, Clone, Copy, PartialEq, Eq, Serialize, Deserialize)]
pub struct FileImportance(u8);

/// ãƒ‡ã‚£ã‚¹ã‚¯å®¹é‡ï¼ˆãƒã‚¤ãƒˆå˜ä½ï¼‰
#[derive(Debug, Clone, Copy, PartialEq, Eq, Serialize, Deserialize)]
pub struct DiskCapacity(u64);

/// å¤±æ•—ç‡ï¼ˆ0.0 - 1.0ï¼‰
#[derive(Debug, Clone, Copy, PartialEq, Serialize, Deserialize)]
pub struct FailureRate(f64);

/// æ™‚ç³»åˆ—ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒˆ
#[derive(Debug, Clone, Serialize, Deserialize)]
pub struct TimeSeriesPoint {
    pub timestamp: chrono::DateTime<chrono::Utc>,
    pub value: f64,
}
```

### 2.3 ã‚¨ãƒ©ãƒ¼å‹è¨­è¨ˆ

```rust
// src/ai/error.rs

#[derive(Error, Debug)]
pub enum AiError {
    #[error("çµ±è¨ˆè¨ˆç®—ã‚¨ãƒ©ãƒ¼: {0}")]
    StatisticsError(String),

    #[error("äºˆæ¸¬ãƒ¢ãƒ‡ãƒ«ã‚¨ãƒ©ãƒ¼: {0}")]
    PredictionError(String),

    #[error("ãƒ‡ãƒ¼ã‚¿ä¸è¶³: æœ€ä½{required}ä»¶å¿…è¦ã§ã™ãŒã€{actual}ä»¶ã—ã‹ã‚ã‚Šã¾ã›ã‚“")]
    InsufficientData { required: usize, actual: usize },

    #[error("ç„¡åŠ¹ãªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿: {0}")]
    InvalidParameter(String),

    #[cfg(feature = "llm")]
    #[error("LLMé€šä¿¡ã‚¨ãƒ©ãƒ¼: {0}")]
    LlmCommunicationError(#[from] reqwest::Error),

    #[cfg(feature = "llm")]
    #[error("LLMã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ: {seconds}ç§’ä»¥å†…ã«å¿œç­”ãŒã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸ")]
    LlmTimeout { seconds: u64 },

    #[cfg(feature = "llm")]
    #[error("OllamaãŒæœªã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ã™")]
    OllamaNotInstalled,

    #[error("I/Oã‚¨ãƒ©ãƒ¼: {0}")]
    IoError(#[from] std::io::Error),

    #[error("AIã‚¨ãƒ©ãƒ¼: {0}")]
    Other(#[from] anyhow::Error),
}

pub type AiResult<T> = std::result::Result<T, AiError>;
```

---

## 3. Phase 1: è»½é‡MLæ©Ÿèƒ½

### 3.1 ç•°å¸¸æ¤œçŸ¥ã‚¨ãƒ³ã‚¸ãƒ³

#### 3.1.1 å®Ÿè£…æ¦‚è¦

**ç›®çš„**: ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å±¥æ­´ãƒ‡ãƒ¼ã‚¿ã®çµ±è¨ˆçš„ç•°å¸¸æ¤œçŸ¥

**ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ **:
- Z-score ç•°å¸¸å€¤æ¤œå‡ºï¼ˆãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚µã‚¤ã‚ºæ€¥å¤‰ï¼‰
- ç§»å‹•å¹³å‡ãƒ»æ¨™æº–åå·®ï¼ˆãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æï¼‰
- ç·šå½¢å›å¸°ï¼ˆãƒ‡ã‚£ã‚¹ã‚¯å®¹é‡äºˆæ¸¬ï¼‰

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: `src/ai/anomaly/detector.rs`

#### 3.1.2 ä¸»è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

```rust
/// ç•°å¸¸æ¤œçŸ¥å™¨
pub struct AnomalyDetector {
    threshold: AnomalyThreshold,
}

/// ç•°å¸¸æ¤œçŸ¥é–¾å€¤
#[derive(Debug, Clone, Copy)]
pub struct AnomalyThreshold {
    pub z_score: f64,        // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 3.0
    pub window_size: usize,  // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 7æ—¥é–“
}

/// ç•°å¸¸æ¤œçŸ¥çµæœ
#[derive(Debug, Clone)]
pub struct AnomalyResult {
    pub is_anomaly: bool,
    pub z_score: f64,
    pub confidence: PredictionConfidence,
    pub description: String,
    pub recommended_action: Option<String>,
}
```

#### 3.1.3 ä½¿ç”¨ã‚¯ãƒ¬ãƒ¼ãƒˆ

```toml
statrs = "0.17"  # çµ±è¨ˆé–¢æ•°ï¼ˆZ-scoreã€å›å¸°ç­‰ï¼‰
ndarray = "0.16" # æ•°å€¤è¨ˆç®—ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
```

#### 3.1.4 ãƒ†ã‚¹ãƒˆæˆ¦ç•¥

```rust
// proptest ã«ã‚ˆã‚‹ property-based testing
proptest! {
    #[test]
    fn anomaly_detection_is_deterministic(sizes in vec(1000u64..100000, 5..20)) {
        let detector = AnomalyDetector::default_detector();
        let histories = create_mock_histories(&sizes);
        let current = BackupSize::new(50000);

        let result1 = detector.detect_size_anomaly(&histories, current);
        let result2 = detector.detect_size_anomaly(&histories, current);

        assert_eq!(
            result1.as_ref().map(|r| r.is_anomaly),
            result2.as_ref().map(|r| r.is_anomaly)
        );
    }
}
```

### 3.2 ã‚¤ãƒ³ãƒ†ãƒªã‚¸ã‚§ãƒ³ãƒˆæ¨å¥¨ã‚¨ãƒ³ã‚¸ãƒ³

#### 3.2.1 å®Ÿè£…æ¦‚è¦

**ç›®çš„**: ãƒ•ã‚¡ã‚¤ãƒ«é‡è¦åº¦ã®è‡ªå‹•åˆ¤å®šã€ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å¯¾è±¡ãƒ»é™¤å¤–å€™è£œã®ææ¡ˆ

**æ‰‹æ³•**:
- ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°ï¼ˆæ‹¡å¼µå­ã€ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªåï¼‰
- å¤‰æ›´é »åº¦åˆ†æï¼ˆé »ç¹ã«å¤‰æ›´ã•ã‚Œã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã¯é‡è¦åº¦é«˜ï¼‰
- ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºãƒ»ã‚¢ã‚¯ã‚»ã‚¹æ™‚åˆ»åˆ†æ

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: `src/ai/recommendation/importance.rs`

#### 3.2.2 ä¸»è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

```rust
/// é‡è¦åº¦åˆ¤å®šã‚¨ãƒ³ã‚¸ãƒ³
pub struct ImportanceEvaluator {
    rules: Vec<ImportanceRule>,
}

/// ãƒ•ã‚¡ã‚¤ãƒ«é‡è¦åº¦è©•ä¾¡çµæœ
pub struct FileImportanceResult {
    pub path: PathBuf,
    pub score: FileImportance,
    pub priority: Priority,
    pub category: String,
    pub reason: String,
}

/// é™¤å¤–ææ¡ˆ
pub struct ExcludeRecommendation {
    pub pattern: String,
    pub confidence: PredictionConfidence,
    pub size_reduction_gb: f64,
    pub reason: String,
}
```

#### 3.2.3 ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°

```rust
// é«˜é‡è¦åº¦ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ80-100ç‚¹ï¼‰
- ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ: .docx, .pdf, .xlsx, .pptx
- ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰: .rs, .py, .js, .ts, .java, .go
- è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«: .toml, .yaml, .json, .ini

// ä¸­é‡è¦åº¦ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ40-79ç‚¹ï¼‰
- ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«: .jpg, .png, .gif
- ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«: .csv, .db, .sqlite

// ä½é‡è¦åº¦ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ0-39ç‚¹ï¼‰
- ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«: .tmp, .temp, .cache
- ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«: .log

// ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãƒ™ãƒ¼ã‚¹åˆ¤å®š
- Documents/, src/, config/ â†’ é«˜é‡è¦åº¦
- cache/, .cache/, node_modules/ â†’ é™¤å¤–æ¨å¥¨
```

### 3.3 CLIçµ±åˆï¼ˆPhase 1ï¼‰

#### 3.3.1 æ–°è¦ã‚³ãƒãƒ³ãƒ‰

```bash
# ç•°å¸¸æ¤œçŸ¥ãƒ¬ãƒãƒ¼ãƒˆ
backup-suite ai detect [--days N] [--format table|json|detailed]

# ãƒ•ã‚¡ã‚¤ãƒ«é‡è¦åº¦åˆ†æ
backup-suite ai analyze <PATH> [--suggest-priority] [--detailed]

# é™¤å¤–ãƒ•ã‚¡ã‚¤ãƒ«ææ¡ˆ
backup-suite ai suggest-exclude <PATH> [--apply] [--confidence 0.8]

# AIé§†å‹•ã®è‡ªå‹•è¨­å®š
backup-suite ai auto-configure <PATH>... [--dry-run] [--interactive]
```

#### 3.3.2 å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆä¾‹

**ç•°å¸¸æ¤œçŸ¥ãƒ¬ãƒãƒ¼ãƒˆï¼ˆãƒ†ãƒ¼ãƒ–ãƒ«å½¢å¼ï¼‰**:
```
ğŸ¤– AIç•°å¸¸æ¤œçŸ¥ãƒ¬ãƒãƒ¼ãƒˆï¼ˆéå»7æ—¥é–“ï¼‰

â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ No â”‚ æ¤œå‡ºæ—¥æ™‚                   â”‚ ç•°å¸¸ç¨®åˆ¥     â”‚ ä¿¡é ¼åº¦    â”‚ èª¬æ˜                      â”‚
â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1  â”‚ 2025-11-09 03:15         â”‚ ã‚µã‚¤ã‚ºæ€¥å¢—   â”‚ 95.3%    â”‚ ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºãŒé€šå¸¸ã®3å€  â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ“Š ã‚µãƒãƒªãƒ¼: 1ä»¶ã®ç•°å¸¸ã‚’æ¤œå‡º
ğŸ’¡ æ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³: ~/Downloads ã®ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é™¤å¤–è¨­å®šã«è¿½åŠ 
```

**ãƒ•ã‚¡ã‚¤ãƒ«é‡è¦åº¦åˆ†æï¼ˆãƒ†ãƒ¼ãƒ–ãƒ«å½¢å¼ï¼‰**:
```
ğŸ¤– AIãƒ•ã‚¡ã‚¤ãƒ«é‡è¦åº¦åˆ†æ: ~/Documents/project

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ãƒ•ã‚¡ã‚¤ãƒ«/ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª             â”‚ é‡è¦åº¦ã‚¹ã‚³ã‚¢   â”‚ ææ¡ˆå„ªå…ˆåº¦ â”‚ ç†ç”±                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ src/                            â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 95  â”‚ é«˜        â”‚ ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ï¼ˆé »ç¹æ›´æ–°ï¼‰â”‚
â”‚ node_modules/                   â”‚ â–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘ 15  â”‚ é™¤å¤–æ¨å¥¨  â”‚ å†ç”Ÿæˆå¯èƒ½ãªä¾å­˜é–¢ä¿‚    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. Phase 2: Ollamaçµ±åˆ

### 4.1 Ollama ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ

#### 4.1.1 å®Ÿè£…æ¦‚è¦

**ç›®çš„**: Ollama HTTP APIå‘¼ã³å‡ºã—ã€Graceful degradation

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: `src/ai/llm/ollama_client.rs`

#### 4.1.2 ä¸»è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

```rust
pub struct OllamaClient {
    base_url: String,  // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: http://localhost:11434
    model: String,     // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: llama3.2:3b
    timeout: Duration,
}

impl OllamaClient {
    /// Ollama ãŒåˆ©ç”¨å¯èƒ½ã‹ç¢ºèª
    pub async fn is_available(&self) -> bool;

    /// ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ Ollama ã«é€ä¿¡
    pub async fn generate(&self, prompt: &str) -> Result<String>;

    /// è‡ªç„¶è¨€èªã‹ã‚‰ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—è¨­å®šã‚’ç”Ÿæˆ
    pub async fn parse_backup_request(&self, user_input: &str) -> Result<BackupConfig>;

    /// ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ¬ãƒãƒ¼ãƒˆã®è‡ªç„¶è¨€èªã‚µãƒãƒªãƒ¼ç”Ÿæˆ
    pub async fn generate_report_summary(&self, stats: &BackupStats) -> Result<String>;
}
```

#### 4.1.3 Graceful Degradation

```rust
pub fn check_ollama_status() -> Result<OllamaStatus> {
    // ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ç¢ºèª
    let installed = Command::new("which")
        .arg("ollama")
        .output()
        .map(|o| o.status.success())
        .unwrap_or(false);

    if !installed {
        return Ok(OllamaStatus {
            installed: false,
            running: false,
            version: None,
        });
    }

    // èµ·å‹•ç¢ºèª
    let running = Command::new("curl")
        .args(&["-s", "http://localhost:11434/api/tags"])
        .output()
        .map(|o| o.status.success())
        .unwrap_or(false);

    Ok(OllamaStatus { installed: true, running, version })
}
```

**Ollamaæœªã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ™‚ã®å‹•ä½œ**:
- Phase 1ã®è»½é‡MLæ©Ÿèƒ½ã®ã¿æä¾›
- ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚¬ã‚¤ãƒ‰è¡¨ç¤º
- ä»£æ›¿æ©Ÿèƒ½ã®æ¡ˆå†…

### 4.2 è‡ªç„¶è¨€èªãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—è¨­å®š

#### 4.2.1 å®Ÿè£…æ¦‚è¦

**ç›®çš„**: è‡ªç„¶è¨€èªå…¥åŠ›ã‹ã‚‰ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—è¨­å®šã‚’è‡ªå‹•ç”Ÿæˆ

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: `src/ai/llm/parser.rs`

#### 4.2.2 ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°

```rust
let prompt = format!(
    r#"ä»¥ä¸‹ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—è¨­å®šJSONã«å¤‰æ›ã—ã¦ãã ã•ã„ã€‚

ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒªã‚¯ã‚¨ã‚¹ãƒˆ: {}

å‡ºåŠ›å½¢å¼ï¼ˆJSONï¼‰ï¼š
{{
    "paths": ["ãƒ‘ã‚¹1", "ãƒ‘ã‚¹2"],
    "priority": "high" | "medium" | "low",
    "schedule": "daily" | "weekly" | "monthly",
    "time": "HH:MM",
    "compression": "zstd" | "gzip" | "none",
    "encrypt": true | false,
    "category": "ã‚«ãƒ†ã‚´ãƒªå"
}}

JSON ã®ã¿ã‚’å‡ºåŠ›ã—ã¦ãã ã•ã„ï¼ˆèª¬æ˜ä¸è¦ï¼‰ã€‚
"#,
    user_input
);
```

### 4.3 AIé§†å‹•ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ

#### 4.3.1 å®Ÿè£…æ¦‚è¦

**ç›®çš„**: ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—çµ±è¨ˆã®è‡ªç„¶è¨€èªã‚µãƒãƒªãƒ¼ç”Ÿæˆã€æ”¹å–„ææ¡ˆ

**å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«**: `src/ai/llm/report.rs`

#### 4.3.2 ãƒ¬ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ

```
ğŸ¤– AIé§†å‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ¬ãƒãƒ¼ãƒˆï¼ˆéå»30æ—¥é–“ï¼‰

ğŸ“Š ã‚µãƒãƒªãƒ¼:
  éå»30æ—¥é–“ã§45å›ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’å®Ÿè¡Œã—ã€ç·å®¹é‡ã¯152GBã§ã™ã€‚
  ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—æˆåŠŸç‡ã¯97.8%ã§ã€å¹³å‡å‡¦ç†æ™‚é–“ã¯12åˆ†ã§ã™ã€‚

ğŸ’¡ æ”¹å–„ææ¡ˆ:
  1. ~/Downloads ã®ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ3.2GBï¼‰ã‚’é™¤å¤–è¨­å®šã«è¿½åŠ ã™ã‚‹ã¨ã€
     ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—æ™‚é–“ã‚’15%çŸ­ç¸®ã§ãã¾ã™ã€‚

  2. src/ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®å¢—åˆ†ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’æœ‰åŠ¹åŒ–ã™ã‚‹ã¨ã€
     ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ä½¿ç”¨é‡ã‚’40%å‰Šæ¸›ã§ãã¾ã™ã€‚

âš ï¸ ãƒªã‚¹ã‚¯è©•ä¾¡:
  ç¾åœ¨ã®ãƒ‡ã‚£ã‚¹ã‚¯ä½¿ç”¨ç‡ã¯82%ã§ã™ã€‚ä»Šã®ãƒšãƒ¼ã‚¹ã§ã¯ç´„45æ—¥å¾Œã«
  å®¹é‡ä¸è¶³ã«ãªã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚å¤ã„ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã®å‰Šé™¤ã‚’æ¤œè¨ã—ã¦ãã ã•ã„ã€‚
```

### 4.4 CLIçµ±åˆï¼ˆPhase 2ï¼‰

```bash
# è‡ªç„¶è¨€èªã§ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—è¨­å®š
backup-suite ai setup "æ¯æ—¥åˆå‰2æ™‚ã«é‡è¦ãªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—"

# AIé§†å‹•ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
backup-suite ai report --days 30 --format markdown

# ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãªè¨­å®šã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
backup-suite ai assistant
```

---

## 5. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®äº‹é …

### 5.1 ãƒ‡ãƒ¼ã‚¿ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼

#### 5.1.1 æ©Ÿå¯†æƒ…å ±ã®ä¿è­·

**åŸå‰‡**:
- ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã€æš—å·éµã€å€‹äººæƒ…å ±ã¯ **çµ¶å¯¾ã«LLMã«é€ä¿¡ã—ãªã„**
- ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—çµ±è¨ˆãƒ‡ãƒ¼ã‚¿ã¯åŒ¿ååŒ–ãƒ»é›†ç´„åŒ–ã—ã¦é€ä¿¡

**å®Ÿè£…**:
```rust
impl LlmClient {
    fn contains_sensitive_info(&self, input: &str) -> bool {
        let sensitive_patterns = [
            "password", "ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰", "secret", "ç§˜å¯†éµ",
            "api_key", "token", "credential"
        ];

        sensitive_patterns.iter().any(|p| {
            input.to_lowercase().contains(p)
        })
    }

    pub async fn parse_natural_language(&self, input: &str) -> AiResult<BackupConfig> {
        // æ©Ÿå¯†æƒ…å ±ãƒã‚§ãƒƒã‚¯
        if self.contains_sensitive_info(input) {
            return Err(AiError::InvalidParameter(
                "æ©Ÿå¯†æƒ…å ±ã‚’å«ã‚€å…¥åŠ›ã¯å—ã‘ä»˜ã‘ã‚‰ã‚Œã¾ã›ã‚“".to_string()
            ));
        }

        // Ollamaã¸ã®é€ä¿¡å‡¦ç†...
    }
}
```

#### 5.1.2 ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹æƒ…å ±ã®æœ€å°åŒ–

**å¯¾ç­–**:
- ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã®é€ä¿¡æ™‚ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚„ãƒ›ãƒ¼ãƒ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ `~` ã«ç½®æ›
- æ©Ÿå¯†æ€§ã®é«˜ã„ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªåï¼ˆ`.ssh/`, `.gnupg/` ç­‰ï¼‰ã¯é€ä¿¡å‰ã«ãƒã‚¹ã‚¯

**å®Ÿè£…**:
```rust
fn sanitize_path_for_llm(path: &Path) -> String {
    let path_str = path.to_string_lossy();

    // ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’ ~ ã«ç½®æ›
    let sanitized = path_str.replace(&dirs::home_dir().unwrap().to_string_lossy(), "~");

    // æ©Ÿå¯†ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ãƒã‚¹ã‚¯
    let sensitive_dirs = [".ssh", ".gnupg", ".aws", ".kube"];
    let mut result = sanitized;
    for dir in sensitive_dirs {
        result = result.replace(dir, "[REDACTED]");
    }

    result
}
```

### 5.2 Ollamaé€šä¿¡ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

#### 5.2.1 é€šä¿¡ã®å®‰å…¨æ€§

**ç¾çŠ¶ã®ãƒªã‚¹ã‚¯**:
- localhost HTTP é€šä¿¡ï¼ˆæš—å·åŒ–ãªã—ï¼‰
- ç›—è´ãƒªã‚¹ã‚¯ã¯ä½ã„ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«é€šä¿¡ã®ã¿ï¼‰

**å¯¾ç­–**:
- Ollama ã¯ localhost:11434 ã§ã®ã¿é€šä¿¡ï¼ˆå¤–éƒ¨é€šä¿¡ç¦æ­¢ï¼‰
- ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¨­å®šï¼ˆ5ç§’ï¼‰ã§DoSé˜²æ­¢

#### 5.2.2 ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³å¯¾ç­–

**å¯¾ç­–**:
- ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã®ã‚µãƒ‹ã‚¿ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³
- ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®å³æ ¼åŒ–
- å‡ºåŠ›ã®JSONæ¤œè¨¼

**å®Ÿè£…**:
```rust
pub async fn parse_backup_request(&self, user_input: &str) -> AiResult<BackupConfig> {
    // å…¥åŠ›é•·åˆ¶é™ï¼ˆ1000æ–‡å­—ã¾ã§ï¼‰
    if user_input.len() > 1000 {
        return Err(AiError::InvalidParameter("å…¥åŠ›ãŒé•·ã™ãã¾ã™".to_string()));
    }

    // å±é™ºãªæ–‡å­—åˆ—ãƒ‘ã‚¿ãƒ¼ãƒ³ã®æ¤œå‡º
    let dangerous_patterns = ["<script>", "DROP TABLE", "'; --"];
    if dangerous_patterns.iter().any(|p| user_input.contains(p)) {
        return Err(AiError::InvalidParameter("ä¸æ­£ãªå…¥åŠ›ã§ã™".to_string()));
    }

    let response = self.generate(&prompt).await?;

    // JSONæ¤œè¨¼
    let config: BackupConfig = serde_json::from_str(&response)
        .map_err(|e| AiError::LlmParseError(format!("JSONè§£æå¤±æ•—: {}", e)))?;

    Ok(config)
}
```

### 5.3 ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ èµ°æŸ»

#### 5.3.1 ãƒ‘ã‚¹ãƒˆãƒ©ãƒãƒ¼ã‚µãƒ«å¯¾ç­–

**å¯¾ç­–**:
- æ—¢å­˜ã® `src/security/path.rs` ã® `canonicalize` ä½¿ç”¨
- ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯æ”»æ’ƒå¯¾ç­–

**å®Ÿè£…**:
```rust
use crate::security::path::validate_path;

pub fn analyze_importance(&self, path: &Path) -> AiResult<FileImportance> {
    // ãƒ‘ã‚¹ãƒˆãƒ©ãƒãƒ¼ã‚µãƒ«å¯¾ç­–
    validate_path(path)?;

    // åˆ†æå‡¦ç†...
}
```

### 5.4 ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] æ©Ÿå¯†æƒ…å ±ï¼ˆãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã€æš—å·éµï¼‰ã¯LLMã«é€ä¿¡ã—ãªã„
- [ ] Ollama APIå‘¼ã³å‡ºã—ã«ã¯å³å¯†ãªã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¨­å®šï¼ˆ5ç§’ï¼‰
- [ ] ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‹ã‚‰ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã®æ©Ÿå¯†æƒ…å ±ã‚’é™¤å¤–
- [ ] çµ±è¨ˆè¨ˆç®—ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼å¯¾ç­–ï¼ˆchecked arithmeticï¼‰
- [ ] AIæ©Ÿèƒ½ã®ç„¡åŠ¹åŒ–ã§ã‚‚åŸºæœ¬æ©Ÿèƒ½ã¯æ­£å¸¸å‹•ä½œï¼ˆFeature gateï¼‰
- [ ] ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³å¯¾ç­–ï¼ˆå…¥åŠ›æ¤œè¨¼ï¼‰
- [ ] ãƒ‘ã‚¹ãƒˆãƒ©ãƒãƒ¼ã‚µãƒ«å¯¾ç­–ï¼ˆæ—¢å­˜ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ©Ÿèƒ½æ´»ç”¨ï¼‰

---

## 6. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›®æ¨™

### 6.1 Phase 1ï¼ˆè»½é‡MLï¼‰

| æ“ä½œ | ãƒ‡ãƒ¼ã‚¿é‡ | ç›®æ¨™æ™‚é–“ | å‚™è€ƒ |
|------|---------|---------|------|
| ç•°å¸¸æ¤œçŸ¥ | 100ä»¶å±¥æ­´ | < 5ms | çµ±è¨ˆè¨ˆç®—ã®ã¿ |
| å‚¾å‘åˆ†æ | 1000ä»¶å±¥æ­´ | < 50ms | ç§»å‹•å¹³å‡è¨ˆç®— |
| é‡è¦åº¦è©•ä¾¡ | 1ãƒ•ã‚¡ã‚¤ãƒ« | < 100Î¼s | ãƒ«ãƒ¼ãƒ«ãƒãƒƒãƒãƒ³ã‚° |
| ãƒ•ã‚¡ã‚¤ãƒ«é‡è¦åº¦åˆ†æ | 10,000ãƒ•ã‚¡ã‚¤ãƒ« | < 10ç§’ | walkdirèµ°æŸ» |

### 6.2 Phase 2ï¼ˆOllamaçµ±åˆï¼‰

| æ“ä½œ | å‡¦ç†å†…å®¹ | ç›®æ¨™æ™‚é–“ | å‚™è€ƒ |
|------|---------|---------|------|
| Ollama APIå‘¼ã³å‡ºã— | 1ãƒªã‚¯ã‚¨ã‚¹ãƒˆ | < 5ç§’ | ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¨­å®š |
| è‡ªç„¶è¨€èªè¨­å®šç”Ÿæˆ | 1è¨­å®š | < 5ç§’ | LLMæ¨è«–æ™‚é–“ |
| AIãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ | 30æ—¥åˆ†çµ±è¨ˆ | < 10ç§’ | LLMæ¨è«–æ™‚é–“ |

### 6.3 æœ€é©åŒ–æˆ¦ç•¥

#### 6.3.1 ä¸¦åˆ—å‡¦ç†ï¼ˆrayonæ´»ç”¨ï¼‰

```rust
use rayon::prelude::*;

pub fn analyze_directory(&self, base_path: &Path) -> AiResult<Vec<FileImportanceResult>> {
    let entries: Vec<_> = WalkDir::new(base_path)
        .max_depth(3)
        .into_iter()
        .filter_map(|e| e.ok())
        .collect();

    // ä¸¦åˆ—ã§é‡è¦åº¦è©•ä¾¡
    let results: Vec<_> = entries
        .par_iter()
        .map(|entry| self.evaluate_importance(entry.path()))
        .collect();

    Ok(results)
}
```

#### 6.3.2 ãƒ¡ãƒ¢ãƒªåŠ¹ç‡ï¼ˆã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°å‡¦ç†ï¼‰

```rust
// å¤§é‡ã®å±¥æ­´ãƒ‡ãƒ¼ã‚¿ã‚’åŠ¹ç‡çš„ã«å‡¦ç†
pub fn analyze_trend_streaming(&self, histories: impl Iterator<Item = BackupHistory>)
    -> AiResult<Vec<TimeSeriesPoint>>
{
    let mut moving_averages = Vec::new();
    let mut window = VecDeque::with_capacity(self.threshold.window_size);

    for history in histories {
        window.push_back(history.total_bytes as f64);

        if window.len() == self.threshold.window_size {
            let avg = window.iter().sum::<f64>() / self.threshold.window_size as f64;
            moving_averages.push(TimeSeriesPoint::new(history.timestamp, avg));
            window.pop_front();
        }
    }

    Ok(moving_averages)
}
```

#### 6.3.3 ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°æˆ¦ç•¥

```rust
use std::collections::HashMap;
use std::sync::Mutex;

pub struct ImportanceEvaluator {
    rules: Vec<ImportanceRule>,
    cache: Mutex<HashMap<PathBuf, FileImportance>>,
}

impl ImportanceEvaluator {
    pub fn evaluate_cached(&self, path: &Path) -> AiResult<FileImportance> {
        // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ’ãƒƒãƒˆç¢ºèª
        {
            let cache = self.cache.lock().unwrap();
            if let Some(&importance) = cache.get(path) {
                return Ok(importance);
            }
        }

        // è©•ä¾¡å®Ÿè¡Œ
        let importance = self.evaluate(path)?;

        // ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ›´æ–°
        {
            let mut cache = self.cache.lock().unwrap();
            cache.insert(path.to_path_buf(), importance);
        }

        Ok(importance)
    }
}
```

### 6.4 ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯è¨­è¨ˆ

```rust
// benches/ai_benchmark.rs

use criterion::{black_box, criterion_group, criterion_main, BenchmarkId, Criterion};

fn anomaly_detection_benchmark(c: &mut Criterion) {
    let mut group = c.benchmark_group("anomaly_detection");

    for data_size in [10, 50, 100, 500, 1000].iter() {
        group.bench_with_input(
            BenchmarkId::from_parameter(data_size),
            data_size,
            |b, &size| {
                let detector = AnomalyDetector::default_detector();
                let histories = create_mock_histories_for_bench(size);
                let current = BackupSize::new(50000);

                b.iter(|| {
                    detector.detect_size_anomaly(black_box(&histories), black_box(current))
                });
            },
        );
    }

    group.finish();
}

criterion_group!(benches, anomaly_detection_benchmark);
criterion_main!(benches);
```

---

## 7. å®Ÿè£…ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—

### 7.1 Phase 1ï¼ˆè»½é‡MLï¼‰- 2é€±é–“

#### Week 1: åŸºç›¤æ•´å‚™

**Day 1-2**: å‹å®šç¾©ãƒ»ã‚¨ãƒ©ãƒ¼å‡¦ç†
- [ ] `src/ai/types.rs` å®Ÿè£…
- [ ] `src/ai/error.rs` å®Ÿè£…
- [ ] å˜ä½“ãƒ†ã‚¹ãƒˆï¼ˆproptestæ´»ç”¨ï¼‰

**Day 3-5**: ç•°å¸¸æ¤œçŸ¥ã‚¨ãƒ³ã‚¸ãƒ³
- [ ] `src/ai/anomaly/detector.rs` å®Ÿè£…
- [ ] `src/ai/anomaly/predictor.rs` å®Ÿè£…
- [ ] çµ±åˆãƒ†ã‚¹ãƒˆ

#### Week 2: æ¨å¥¨ã‚¨ãƒ³ã‚¸ãƒ³ãƒ»CLIçµ±åˆ

**Day 6-7**: æ¨å¥¨ã‚¨ãƒ³ã‚¸ãƒ³
- [ ] `src/ai/recommendation/importance.rs` å®Ÿè£…
- [ ] `src/ai/recommendation/exclude.rs` å®Ÿè£…

**Day 8-10**: CLIçµ±åˆ
- [ ] `src/main.rs` ã« `ai` ã‚µãƒ–ã‚³ãƒãƒ³ãƒ‰è¿½åŠ 
- [ ] `src/i18n.rs` ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚­ãƒ¼è¿½åŠ 
- [ ] å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆå®Ÿè£…ï¼ˆãƒ†ãƒ¼ãƒ–ãƒ«ãƒ»JSONï¼‰

**Day 11-14**: ãƒ†ã‚¹ãƒˆãƒ»ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
- [ ] çµ±åˆãƒ†ã‚¹ãƒˆå®Œäº†
- [ ] ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ä½œæˆ
- [ ] READMEæ›´æ–°

### 7.2 Phase 2ï¼ˆOllamaçµ±åˆï¼‰- 1é€±é–“

#### Week 3: Ollamaçµ±åˆ

**Day 15-16**: Ollama ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
- [ ] `src/ai/llm/client.rs` å®Ÿè£…
- [ ] Graceful degradationå®Ÿè£…

**Day 17-18**: è‡ªç„¶è¨€èªå‡¦ç†
- [ ] `src/ai/llm/parser.rs` å®Ÿè£…
- [ ] `src/ai/llm/report.rs` å®Ÿè£…

**Day 19-21**: CLIçµ±åˆãƒ»ãƒ†ã‚¹ãƒˆ
- [ ] `ai setup/report/assistant` ã‚³ãƒãƒ³ãƒ‰å®Ÿè£…
- [ ] çµ±åˆãƒ†ã‚¹ãƒˆ
- [ ] ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°

### 7.3 ãƒªãƒªãƒ¼ã‚¹æº–å‚™

**Day 22-24**:
- [ ] ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£æŸ»
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯
- [ ] CI/CD ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³æ›´æ–°
- [ ] ãƒªãƒªãƒ¼ã‚¹ãƒãƒ¼ãƒˆä½œæˆ

---

## 8. ãƒ†ã‚¹ãƒˆæˆ¦ç•¥

### 8.1 å˜ä½“ãƒ†ã‚¹ãƒˆ

#### 8.1.1 proptest ã«ã‚ˆã‚‹ Property-based Testing

```rust
// tests/ai_property_tests.rs

proptest! {
    #[test]
    fn backup_size_always_non_negative(bytes in 0u64..=u64::MAX) {
        let size = BackupSize::new(bytes);
        assert!(size.get() >= 0);
    }

    #[test]
    fn confidence_always_in_range(confidence in 0.0f64..=1.0) {
        let conf = PredictionConfidence::new(confidence);
        assert!((0.0..=1.0).contains(&conf.get()));
    }

    #[test]
    fn anomaly_detection_is_deterministic(
        sizes in prop::collection::vec(1000u64..100000, 5..20)
    ) {
        let detector = AnomalyDetector::default_detector();
        let histories = create_mock_histories(&sizes);
        let current = BackupSize::new(50000);

        let result1 = detector.detect_size_anomaly(&histories, current);
        let result2 = detector.detect_size_anomaly(&histories, current);

        assert_eq!(
            result1.as_ref().map(|r| r.is_anomaly),
            result2.as_ref().map(|r| r.is_anomaly)
        );
    }
}
```

### 8.2 çµ±åˆãƒ†ã‚¹ãƒˆ

```rust
// tests/integration_tests/ai_integration.rs

#[test]
fn test_ai_detect_command_integration() {
    let temp_dir = tempfile::tempdir().unwrap();
    let config_path = temp_dir.path().join("config.toml");

    // ãƒ¢ãƒƒã‚¯å±¥æ­´ãƒ‡ãƒ¼ã‚¿ä½œæˆ
    create_mock_backup_histories(&temp_dir, 10);

    // ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œ
    let output = Command::new("backup-suite")
        .arg("ai")
        .arg("detect")
        .arg("--format")
        .arg("json")
        .env("BACKUP_SUITE_CONFIG", &config_path)
        .output()
        .expect("Failed to execute command");

    assert!(output.status.success());

    // JSONå‡ºåŠ›æ¤œè¨¼
    let result: serde_json::Value = serde_json::from_slice(&output.stdout).unwrap();
    assert!(result["anomalies"].is_array());
}
```

### 8.3 ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ç›®æ¨™

- **å…¨ä½“ã‚«ãƒãƒ¬ãƒƒã‚¸**: 95%ä»¥ä¸Š
- **ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«ãƒ‘ã‚¹**: 100%
- **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: 100%

---

## 9. ä¾å­˜é–¢ä¿‚

### 9.1 Cargo.toml æ›´æ–°

```toml
[dependencies]
# æ—¢å­˜ã®ä¾å­˜é–¢ä¿‚...
anyhow = "1.0.100"
chrono = { version = "0.4.42", features = ["serde"] }
clap = { version = "4.5", features = ["derive", "cargo"] }
serde = { version = "1.0.228", features = ["derive"] }
thiserror = "1.0"

# Phase 1: è»½é‡MLï¼ˆçµ±è¨ˆçš„ç•°å¸¸æ¤œçŸ¥ï¼‰
statrs = "0.17"
# ndarray ã¯ statrs ã«å«ã¾ã‚Œã‚‹ãŸã‚ä¸è¦

[features]
default = ["ai"]  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§AIæ©Ÿèƒ½ã‚’æœ‰åŠ¹åŒ–

# Phase 1: è»½é‡MLæ©Ÿèƒ½
ai = ["statrs"]

# Phase 2: Ollama LLMçµ±åˆ
llm = ["ai", "reqwest", "tokio"]

[dependencies.reqwest]
version = "0.12"
optional = true
features = ["json"]

[dependencies.tokio]
version = "1.0"
optional = true
features = ["full"]
```

### 9.2 MSRVäº’æ›æ€§

- **ç¾åœ¨ã®MSRV**: Rust 1.82.0
- **æ–°è¦ä¾å­˜é–¢ä¿‚ã®ç¢ºèª**:
  - `statrs 0.17`: Rust 1.70+ å¯¾å¿œ âœ…
  - `reqwest 0.12`: Rust 1.70+ å¯¾å¿œ âœ…
  - `tokio 1.0`: Rust 1.70+ å¯¾å¿œ âœ…

---

## 10. ãƒªã‚¹ã‚¯ã¨å¯¾ç­–

### 10.1 æŠ€è¡“çš„ãƒªã‚¹ã‚¯

| ãƒªã‚¹ã‚¯ | å½±éŸ¿ | ç¢ºç‡ | å¯¾ç­– |
|--------|------|------|------|
| Ollama APIã®å¤‰æ›´ | é«˜ | ä¸­ | Feature gateã§åˆ†é›¢ã€ãƒãƒ¼ã‚¸ãƒ§ãƒ³å›ºå®š |
| çµ±è¨ˆè¨ˆç®—ã®ç²¾åº¦ä¸è¶³ | ä¸­ | ä½ | é–¾å€¤èª¿æ•´å¯èƒ½ã«è¨­è¨ˆã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯åé›† |
| ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åŠ£åŒ– | ä¸­ | ä½ | ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ç›£è¦–ã€ä¸¦åˆ—å‡¦ç†æ´»ç”¨ |
| ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡å¢—åŠ  | ä½ | ä½ | ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°å‡¦ç†ã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥åˆ¶é™ |

### 10.2 ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒªã‚¹ã‚¯

| ãƒªã‚¹ã‚¯ | å½±éŸ¿ | ç¢ºç‡ | å¯¾ç­– |
|--------|------|------|------|
| æ©Ÿå¯†æƒ…å ±ã®LLMé€ä¿¡ | é«˜ | ä½ | å…¥åŠ›æ¤œè¨¼ã€æ©Ÿå¯†ãƒ‘ã‚¿ãƒ¼ãƒ³æ¤œå‡º |
| ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ | ä¸­ | ä¸­ | å…¥åŠ›ã‚µãƒ‹ã‚¿ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³ã€å‡ºåŠ›æ¤œè¨¼ |
| ãƒ‘ã‚¹ãƒˆãƒ©ãƒãƒ¼ã‚µãƒ« | é«˜ | ä½ | æ—¢å­˜ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ©Ÿèƒ½æ´»ç”¨ |
| DoSæ”»æ’ƒ | ä½ | ä½ | ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¨­å®šã€ãƒ¬ãƒ¼ãƒˆåˆ¶é™ |

### 10.3 é‹ç”¨ãƒªã‚¹ã‚¯

| ãƒªã‚¹ã‚¯ | å½±éŸ¿ | ç¢ºç‡ | å¯¾ç­– |
|--------|------|------|------|
| Ollamaæœªã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« | ä½ | é«˜ | Graceful degradationã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚¬ã‚¤ãƒ‰ |
| AIæ©Ÿèƒ½ã®èª¤å‹•ä½œ | ä¸­ | ä½ | ãƒ‰ãƒ©ã‚¤ãƒ©ãƒ³ãƒ¢ãƒ¼ãƒ‰ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ç¢ºèª |
| ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ··ä¹± | ä½ | ä¸­ | è©³ç´°ãªãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã€å¯¾è©±çš„UI |

---

## ä»˜éŒ²

### A. å‚è€ƒè³‡æ–™

- [rust-engineer ãƒ¬ãƒãƒ¼ãƒˆ](./RUST_ENGINEER_REPORT.md)
- [cli-developer ãƒ¬ãƒãƒ¼ãƒˆ](./CLI_DEVELOPER_REPORT.md)
- [statrs Documentation](https://docs.rs/statrs/latest/statrs/)
- [Ollama API Docs](https://github.com/ollama/ollama/blob/main/docs/api.md)

### B. å®Ÿè£…ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

#### Phase 1

- [ ] å‹å®šç¾©ï¼ˆnewtype patternï¼‰
- [ ] ã‚¨ãƒ©ãƒ¼å‹ï¼ˆthiserrorï¼‰
- [ ] ç•°å¸¸æ¤œçŸ¥ã‚¨ãƒ³ã‚¸ãƒ³
- [ ] æ¨å¥¨ã‚¨ãƒ³ã‚¸ãƒ³
- [ ] CLIçµ±åˆ
- [ ] ãƒ†ã‚¹ãƒˆï¼ˆproptestï¼‰
- [ ] ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯
- [ ] ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

#### Phase 2

- [ ] Ollama ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
- [ ] Graceful degradation
- [ ] è‡ªç„¶è¨€èªãƒ‘ãƒ¼ã‚µãƒ¼
- [ ] AIãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
- [ ] CLIçµ±åˆ
- [ ] ãƒ†ã‚¹ãƒˆ
- [ ] ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

#### ãƒªãƒªãƒ¼ã‚¹æº–å‚™

- [ ] ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£æŸ»
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯
- [ ] CI/CDæ›´æ–°
- [ ] READMEæ›´æ–°
- [ ] CHANGELOGæ›´æ–°
- [ ] ãƒªãƒªãƒ¼ã‚¹ãƒãƒ¼ãƒˆä½œæˆ

---

**æœ€çµ‚æ›´æ–°**: 2025-11-09
**æ¬¡å›ãƒ¬ãƒ“ãƒ¥ãƒ¼**: 2025-11-16
